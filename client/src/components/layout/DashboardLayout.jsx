import { NavLink, Outlet, useNavigate, useLocation } from "react-router-dom";
import { useState, useCallback, useEffect } from "react";
import LowStockToast from "../overlay/LowStockToast";

import "../../styles/Dashboard.css";

export default function DashboardLayout() {
  const navigate = useNavigate();
  const location = useLocation();
  const [signingOut, setSigningOut] = useState(false);
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    let cancel = false;
    (async () => {
      try {
        const res = await fetch("http://localhost:5000/api/auth/me", {
          credentials: "include",
        });
        if (!res.ok) throw new Error("unauth");
        const data = await res.json();
        if (!cancel) {
          setUser(data.user);
          try { localStorage.setItem("user", JSON.stringify(data.user)); } catch {}
        }
      } catch {
        if (!cancel) navigate("/login", { replace: true });
      } finally {
        if (!cancel) setLoading(false);
      }
    })();
    return () => { cancel = true; };
  }, [navigate]);

  // Redirect baristas away from restricted routes
  useEffect(() => {
    if (!user) return;
    // Treat anything other than explicit 'manager' as restricted
    if (user.role === 'manager') return;
    const path = location.pathname.toLowerCase();
    // Allowed for barista
    const allowed = ["/pos", "/customers"];
    const allowedPrefixes = ["/pos/checkout", "/pos/checkout/receipt"]; // nested POS routes
    const isAllowed = allowed.includes(path) || allowedPrefixes.some(p => path.startsWith(p));
    if (!isAllowed) {
      navigate("/pos", { replace: true });
    }
  }, [user, location.pathname, navigate]);

  const link = ({ isActive }) => ({
    padding: "0.5em 0.8em",
    textDecoration: "none",
    borderRadius: "15px",
    color: isActive ? "#2563EB" : "#000000" ,
    background: isActive ? "#F1F5F9" : "transparent",
  });

  const handleSignOut = useCallback(async (e) => {
    e?.preventDefault?.();
    if (signingOut) return;
    setSigningOut(true);
    try {
      await fetch("http://localhost:5000/api/auth/logout", {
        method: "POST",
        credentials: "include",
        headers: { "Content-Type": "application/json" },
      });
    } catch {
    } finally {
      try { localStorage.removeItem("user"); } catch {}
      setSigningOut(false);
      try {
        navigate("/login", { replace: true });
      } catch {
        window.location.assign("/login");
      }
    }
  }, [signingOut, navigate]);

  return (
    <div className="dashboard">
      <div className="container">
        <aside className="navbar">
          <nav>
            <div className="logo-brand-container">
              <svg width="70" height="70" viewBox="0 0 172 172" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="86" cy="86" r="86" fill="#006599"/>
                <circle cx="86.0033" cy="85.9989" r="73.0189" fill="white"/>
                <path d="M53.2833 48.376H41.2394C39.4413 48.376 38.0421 49.9518 38.2869 51.7331C39.8992 63.4651 42.3298 69.9065 52.7451 75.2149C53.0723 75.3816 53.292 75.7222 53.3071 76.0891C54.3555 101.665 60.2528 111.222 78.2152 120.543C78.5438 120.713 78.759 121.057 78.767 121.427C78.9115 128.045 79.8305 131.327 81.9334 133.991C83.2304 135.634 85.601 135.837 87.3866 134.745C92.4318 131.657 95.1388 128.818 98.4042 123.731C98.5427 123.515 98.7636 123.357 99.0121 123.293C119.805 118.005 130.895 108.806 133.677 88.6124C134.437 83.0976 129.829 78.5227 124.262 78.5227H75.0822C74.5299 78.5227 74.0822 78.075 74.0822 77.5227V76.0704C74.0822 75.7086 74.283 75.3728 74.5969 75.1931C85.352 69.0395 88.5924 63.2182 89.1787 51.4221C89.2618 49.7507 87.9031 48.376 86.2297 48.376H73.3811C68.8604 48.8904 67.0975 49.8313 64.5258 52.1476C64.1196 52.5136 63.4965 52.4963 63.0965 52.1235C60.3485 49.5622 57.6738 48.8011 53.2833 48.376Z" fill="#006599" stroke="#006599"/>
                <path fill-rule="evenodd" clip-rule="evenodd" d="M46.2695 55.1517C48.3106 63.3162 51.1066 66.7951 59.8269 69.8674C60.2398 70.0129 60.5174 70.4152 60.5083 70.8528C60.0231 94.1908 63.4788 104.262 79.9217 113.108C80.5329 110.187 81.3543 108.261 82.9284 105.723C83.7939 104.328 85.4414 103.201 86.9423 103.867C86.9696 103.879 86.9966 103.892 87.0233 103.904C88.3697 104.555 88.2039 106.42 87.6176 107.795C84.2077 115.795 83.3717 120.854 85.7641 129.233C93.5747 122.27 97.1041 117.249 99.915 106.719C100.296 105.293 101.257 104.094 102.551 103.384C108.246 100.261 110.93 97.3471 113.496 92.1487C114.167 90.7889 115.396 89.5243 116.882 89.8267C117.218 89.8951 117.519 90.0064 117.79 90.1531C118.941 90.7779 118.993 92.3217 118.569 93.5607C116.007 101.04 112.392 103.779 105.953 107.766C105.745 107.895 105.589 108.096 105.518 108.329L103.291 115.679C119.335 109.942 124.506 103.33 127.61 87.1761C127.727 86.5656 127.262 85.9968 126.64 85.9939C119.16 85.9581 78.7855 85.7659 74.5467 85.7659C69.956 85.7659 65.9877 80.9166 67.6723 71.1137C67.7296 70.7803 67.9613 70.4978 68.2728 70.3658C76.2373 66.9907 79.5576 62.9603 81.7913 55.1517C73.748 54.1087 69.7041 55.0362 64.7487 60.8296C64.3604 61.2836 63.661 61.3186 63.2334 60.9013C57.1829 54.9957 53.2817 54.0872 46.2695 55.1517Z" fill="white" stroke="white"/>
                <path d="M104.224 74.7824C94.1944 66.8477 111.316 64.3184 99.784 57.0215C108.571 64.0228 90.8457 66.6479 104.224 74.7824Z" fill="#006599"/>
                <path d="M115.715 52.3272C109.088 59.8527 123.242 68.07 107.961 74.7842C118.37 67.0883 106.829 62.2433 115.715 52.3272C115.777 52.2567 115.841 52.1862 115.907 52.1157C115.842 52.1865 115.778 52.257 115.715 52.3272Z" fill="#006599"/>
                <path d="M105.161 69.8747C119.884 58.891 98.8512 57.2552 104.226 46.2715C97.2153 57.9563 113.808 55.1519 105.161 69.8747Z" fill="#006599"/>
                <circle cx="104.697" cy="91.8428" r="3.50543" fill="#006599"/>
                <ellipse cx="103.996" cy="90.6764" rx="2.80435" ry="2.80435" fill="white"/>
              </svg>
              <h1>blue52</h1>
            </div>
            <div className="nav-items">
              <NavLink to="/pos" end style={link} className="nav-item">
                <svg width="24" height="27" viewBox="0 0 24 27" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M22.25 7.25L11.625 1L1 7.25V19.75L11.625 26L22.25 19.75V7.25Z" stroke="#8A8A94" stroke-width="2" stroke-linejoin="round"/>
                  <path d="M11.7129 11.3579V16.3579M16.7129 8.85791V16.3579M6.71289 13.8579V16.3579" stroke="#8A8A94" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <p>POS</p>
              </NavLink>
              <NavLink to="/customers" style={link} className="nav-item">
              <svg width="22" height="26" viewBox="0 0 22 26" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M17.2018 11.375C17.6506 11.5104 18.0779 11.6942 18.4837 11.9263C18.8895 12.1585 19.3145 12.5115 19.7585 12.9855C20.2025 13.4594 20.582 14.018 20.8971 14.6613C21.2122 15.3045 21.4748 16.1363 21.6849 17.1568C21.895 18.1773 22 19.3211 22 20.5882C22 22.0778 21.5226 23.3521 20.5677 24.4113C19.6128 25.4704 18.4622 26 17.1159 26H4.88411C3.53776 26 2.38715 25.4704 1.43229 24.4113C0.477431 23.3521 0 22.0778 0 20.5882C0 19.3211 0.105035 18.1773 0.315104 17.1568C0.525174 16.1363 0.78776 15.3045 1.10286 14.6613C1.41797 14.018 1.79753 13.4594 2.24154 12.9855C2.68555 12.5115 3.11046 12.1585 3.51628 11.9263C3.92209 11.6942 4.34939 11.5104 4.79818 11.375C4.04384 10.1659 3.66667 8.85045 3.66667 7.42857C3.66667 6.42262 3.86003 5.46261 4.24675 4.54855C4.63346 3.63449 5.15625 2.84375 5.8151 2.17634C6.47396 1.50893 7.25456 0.979353 8.1569 0.587612C9.05925 0.195871 10.0069 0 11 0C11.9931 0 12.9408 0.195871 13.8431 0.587612C14.7454 0.979353 15.526 1.50893 16.1849 2.17634C16.8438 2.84375 17.3665 3.63449 17.7533 4.54855C18.14 5.46261 18.3333 6.42262 18.3333 7.42857C18.3333 8.85045 17.9562 10.1659 17.2018 11.375ZM11 1.85714C9.48177 1.85714 8.18555 2.40123 7.11133 3.4894C6.03711 4.57757 5.5 5.89062 5.5 7.42857C5.5 8.96652 6.03711 10.2796 7.11133 11.3677C8.18555 12.4559 9.48177 13 11 13C12.5182 13 13.8145 12.4559 14.8887 11.3677C15.9629 10.2796 16.5 8.96652 16.5 7.42857C16.5 5.89062 15.9629 4.57757 14.8887 3.4894C13.8145 2.40123 12.5182 1.85714 11 1.85714ZM17.1159 24.1429C17.9562 24.1429 18.6747 23.7971 19.2715 23.1055C19.8683 22.4139 20.1667 21.5748 20.1667 20.5882C20.1667 18.2764 19.7919 16.4531 19.0423 15.1183C18.2928 13.7835 17.2161 13.0822 15.8125 13.0145C14.428 14.2429 12.8238 14.8571 11 14.8571C9.17622 14.8571 7.57205 14.2429 6.1875 13.0145C4.78385 13.0822 3.70725 13.7835 2.95768 15.1183C2.20812 16.4531 1.83333 18.2764 1.83333 20.5882C1.83333 21.5748 2.13173 22.4139 2.72852 23.1055C3.3253 23.7971 4.04384 24.1429 4.88411 24.1429H17.1159Z" fill="#8A8A94"/>
              </svg>
              <p>Customers</p>
              </NavLink>
              {user?.role === 'manager' && (
                <>
                  <NavLink to="/inventory" style={link} className="nav-item">
                    <svg width="23" height="23" viewBox="0 0 23 23" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <mask id="path-1-inside-1_685_17" fill="white">
                      <path d="M3.34267 23C2.77022 23 2.28296 22.799 1.88089 22.3969C1.47881 21.9948 1.27778 21.508 1.27778 20.9364V6.72494C0.911481 6.57331 0.606945 6.32756 0.364167 5.98767C0.121389 5.64693 0 5.25635 0 4.81594V2.06361C0 1.49287 0.201037 1.00604 0.603111 0.603111C1.00519 0.201037 1.49244 0 2.06489 0H20.9364C21.5071 0 21.994 0.201037 22.3969 0.603111C22.799 1.00519 23 1.49244 23 2.06489V4.81594C23 5.25635 22.8786 5.6465 22.6358 5.98639C22.3939 6.32713 22.0894 6.57331 21.7222 6.72494V20.9364C21.7222 21.5071 21.5212 21.994 21.1191 22.3969C20.717 22.799 20.2302 23 19.6586 23H3.34267ZM2.55556 6.88083V20.8137C2.55556 21.0752 2.64969 21.292 2.83794 21.4641C3.0262 21.6362 3.26004 21.7222 3.53944 21.7222H19.6599C19.889 21.7222 20.0773 21.6485 20.2247 21.5012C20.372 21.3538 20.4457 21.1655 20.4457 20.9364V6.88083H2.55556ZM2.06361 5.60306H20.9364C21.1655 5.60306 21.3538 5.52937 21.5012 5.382C21.6485 5.23463 21.7222 5.04594 21.7222 4.81594V2.06489C21.7222 1.83489 21.6485 1.6462 21.5012 1.49883C21.3538 1.35146 21.1651 1.27778 20.9351 1.27778H2.06489C1.83489 1.27778 1.6462 1.35146 1.49883 1.49883C1.35146 1.6462 1.27778 1.83489 1.27778 2.06489V4.81594C1.27778 5.04594 1.35146 5.2342 1.49883 5.38072C1.6462 5.52809 1.83489 5.60178 2.06489 5.60178M8.15861 12.6066H14.8414V11.5H8.15861V12.6066Z"/>
                      </mask>
                      <path d="M3.34267 23C2.77022 23 2.28296 22.799 1.88089 22.3969C1.47881 21.9948 1.27778 21.508 1.27778 20.9364V6.72494C0.911481 6.57331 0.606945 6.32756 0.364167 5.98767C0.121389 5.64693 0 5.25635 0 4.81594V2.06361C0 1.49287 0.201037 1.00604 0.603111 0.603111C1.00519 0.201037 1.49244 0 2.06489 0H20.9364C21.5071 0 21.994 0.201037 22.3969 0.603111C22.799 1.00519 23 1.49244 23 2.06489V4.81594C23 5.25635 22.8786 5.6465 22.6358 5.98639C22.3939 6.32713 22.0894 6.57331 21.7222 6.72494V20.9364C21.7222 21.5071 21.5212 21.994 21.1191 22.3969C20.717 22.799 20.2302 23 19.6586 23H3.34267ZM2.55556 6.88083V20.8137C2.55556 21.0752 2.64969 21.292 2.83794 21.4641C3.0262 21.6362 3.26004 21.7222 3.53944 21.7222H19.6599C19.889 21.7222 20.0773 21.6485 20.2247 21.5012C20.372 21.3538 20.4457 21.1655 20.4457 20.9364V6.88083H2.55556ZM2.06361 5.60306H20.9364C21.1655 5.60306 21.3538 5.52937 21.5012 5.382C21.6485 5.23463 21.7222 5.04594 21.7222 4.81594V2.06489C21.7222 1.83489 21.6485 1.6462 21.5012 1.49883C21.3538 1.35146 21.1651 1.27778 20.9351 1.27778H2.06489C1.83489 1.27778 1.6462 1.35146 1.49883 1.49883C1.35146 1.6462 1.27778 1.83489 1.27778 2.06489V4.81594C1.27778 5.04594 1.35146 5.2342 1.49883 5.38072C1.6462 5.52809 1.83489 5.60178 2.06489 5.60178M8.15861 12.6066H14.8414V11.5H8.15861V12.6066Z" fill="#8A8A94"/>
                      <path d="M1.27778 20.9364H2.27778H1.27778ZM1.27778 6.72494H2.27778V6.0566L1.66026 5.80098L1.27778 6.72494ZM0.364167 5.98767L-0.450255 6.56794L-0.449567 6.5689L0.364167 5.98767ZM0.603111 0.603111L-0.103996 -0.103996L-0.104744 -0.103247L0.603111 0.603111ZM22.3969 0.603111L23.104 -0.103996L23.1032 -0.104744L22.3969 0.603111ZM22.6358 5.98639L21.8221 5.40515L21.8204 5.40747L22.6358 5.98639ZM21.7222 6.72494L21.3405 5.80067L20.7222 6.05601V6.72494H21.7222ZM21.1191 22.3969L21.8262 23.104L21.827 23.1032L21.1191 22.3969ZM2.55556 6.88083V5.88083H1.55556V6.88083H2.55556ZM3.53944 21.7222V20.7222V21.7222ZM20.4457 20.9364H19.4457H20.4457ZM20.4457 6.88083H21.4457V5.88083H20.4457V6.88083ZM1.49883 5.38072L2.20594 4.67361L2.20389 4.67157L1.49883 5.38072ZM8.15861 12.6066H7.15861V13.6066H8.15861V12.6066ZM14.8414 12.6066V13.6066H15.8414V12.6066H14.8414ZM14.8414 11.5H15.8414V10.5H14.8414V11.5ZM8.15861 11.5V10.5H7.15861V11.5H8.15861ZM3.34267 23V22C3.03343 22 2.80112 21.9029 2.588 21.6898L1.88089 22.3969L1.17378 23.104C1.76481 23.695 2.50701 24 3.34267 24V23ZM1.88089 22.3969L2.588 21.6898C2.37456 21.4763 2.27778 21.2443 2.27778 20.9364H1.27778H0.277778C0.277778 21.7716 0.583071 22.5133 1.17378 23.104L1.88089 22.3969ZM1.27778 20.9364H2.27778V6.72494H1.27778H0.277778V20.9364H1.27778ZM1.27778 6.72494L1.66026 5.80098C1.47642 5.72488 1.31795 5.6025 1.1779 5.40643L0.364167 5.98767L-0.449567 6.5689C-0.104065 7.05261 0.346542 7.42175 0.895299 7.64891L1.27778 6.72494ZM0.364167 5.98767L1.17859 5.40739C1.06309 5.2453 1 5.05996 1 4.81594H0H-1C-1 5.45274 -0.820316 6.04856 -0.450254 6.56794L0.364167 5.98767ZM0 4.81594H1V2.06361H0H-1V4.81594H0ZM0 2.06361H1C1 1.75692 1.09653 1.52436 1.31097 1.30947L0.603111 0.603111L-0.104744 -0.103247C-0.694458 0.487717 -1 1.22882 -1 2.06361H0ZM0.603111 0.603111L1.31022 1.31022C1.52334 1.0971 1.75565 1 2.06489 1V0V-1C1.22924 -1 0.48703 -0.695021 -0.103996 -0.103996L0.603111 0.603111ZM2.06489 0V1H20.9364V0V-1H2.06489V0ZM20.9364 0V1C21.2431 1 21.4756 1.09653 21.6905 1.31097L22.3969 0.603111L23.1032 -0.104744C22.5123 -0.694458 21.7712 -1 20.9364 -1V0ZM22.3969 0.603111L21.6898 1.31022C21.9029 1.52334 22 1.75565 22 2.06489H23H24C24 1.22924 23.695 0.48703 23.104 -0.103996L22.3969 0.603111ZM23 2.06489H22V4.81594H23H24V2.06489H23ZM23 4.81594H22C22 5.05996 21.9369 5.2444 21.8221 5.40515L22.6358 5.98639L23.4496 6.56763C23.8203 6.0486 24 5.45274 24 4.81594H23ZM22.6358 5.98639L21.8204 5.40747C21.6817 5.6029 21.5242 5.72481 21.3405 5.80067L21.7222 6.72494L22.1039 7.64922C22.6546 7.42182 23.1061 7.05136 23.4512 6.56531L22.6358 5.98639ZM21.7222 6.72494H20.7222V20.9364H21.7222H22.7222V6.72494H21.7222ZM21.7222 20.9364H20.7222C20.7222 21.2431 20.6257 21.4756 20.4113 21.6905L21.1191 22.3969L21.827 23.1032C22.4167 22.5123 22.7222 21.7712 22.7222 20.9364H21.7222ZM21.1191 22.3969L20.412 21.6898C20.1986 21.9032 19.9665 22 19.6586 22V23V24C20.4939 24 21.2355 23.6947 21.8262 23.104L21.1191 22.3969ZM19.6586 23V22H3.34267V23V24H19.6586V23ZM2.55556 6.88083H1.55556V20.8137H2.55556H3.55556V6.88083H2.55556ZM2.55556 20.8137H1.55556C1.55556 21.348 1.76185 21.8353 2.16328 22.2022L2.83794 21.4641L3.51261 20.726C3.5123 20.7257 3.51687 20.7299 3.52356 20.7391C3.53037 20.7485 3.53744 20.7604 3.54342 20.7742C3.55648 20.8043 3.55556 20.8221 3.55556 20.8137H2.55556ZM2.83794 21.4641L2.16328 22.2022C2.55409 22.5594 3.03621 22.7222 3.53944 22.7222V21.7222V20.7222C3.52095 20.7222 3.50944 20.7208 3.50376 20.7199C3.49825 20.7189 3.49738 20.7183 3.49982 20.7192C3.50237 20.7201 3.50588 20.7218 3.50938 20.7239C3.51283 20.726 3.51394 20.7272 3.51261 20.726L2.83794 21.4641ZM3.53944 21.7222V22.7222H19.6599V21.7222V20.7222H3.53944V21.7222ZM19.6599 21.7222V22.7222C20.1253 22.7222 20.5773 22.5627 20.9318 22.2083L20.2247 21.5012L19.5176 20.7941C19.5383 20.7733 19.5701 20.7507 19.6085 20.7357C19.6449 20.7215 19.6663 20.7222 19.6599 20.7222V21.7222ZM20.2247 21.5012L20.9318 22.2083C21.2862 21.8538 21.4457 21.4018 21.4457 20.9364H20.4457H19.4457C19.4457 20.9428 19.445 20.9214 19.4592 20.885C19.4742 20.8466 19.4968 20.8148 19.5176 20.7941L20.2247 21.5012ZM20.4457 20.9364H21.4457V6.88083H20.4457H19.4457V20.9364H20.4457ZM20.4457 6.88083V5.88083H2.55556V6.88083V7.88083H20.4457V6.88083ZM2.06361 5.60306V6.60306H20.9364V5.60306V4.60306H2.06361V5.60306ZM20.9364 5.60306V6.60306C21.4018 6.60306 21.8538 6.44356 22.2083 6.08911L21.5012 5.382L20.7941 4.67489C20.8148 4.65414 20.8466 4.63158 20.885 4.61658C20.9214 4.60231 20.9428 4.60306 20.9364 4.60306V5.60306ZM21.5012 5.382L22.2083 6.08911C22.5635 5.7339 22.7222 5.28101 22.7222 4.81594H21.7222H20.7222C20.7222 4.8232 20.7213 4.8024 20.7355 4.76619C20.7504 4.72806 20.7729 4.69603 20.7941 4.67489L21.5012 5.382ZM21.7222 4.81594H22.7222V2.06489H21.7222H20.7222V4.81594H21.7222ZM21.7222 2.06489H22.7222C22.7222 1.59982 22.5635 1.14693 22.2083 0.791726L21.5012 1.49883L20.7941 2.20594C20.7729 2.1848 20.7504 2.15278 20.7355 2.11464C20.7213 2.07843 20.7222 2.05763 20.7222 2.06489H21.7222ZM21.5012 1.49883L22.2083 0.791726C21.8531 0.436524 21.4002 0.277778 20.9351 0.277778V1.27778V2.27778C20.9424 2.27778 20.9216 2.27867 20.8854 2.26453C20.8472 2.24964 20.8152 2.22707 20.7941 2.20594L21.5012 1.49883ZM20.9351 1.27778V0.277778H2.06489V1.27778V2.27778H20.9351V1.27778ZM2.06489 1.27778V0.277778C1.59983 0.277778 1.14693 0.436522 0.791726 0.791726L1.49883 1.49883L2.20594 2.20594C2.1848 2.22708 2.15278 2.24964 2.11464 2.26453C2.07843 2.27867 2.05763 2.27778 2.06489 2.27778V1.27778ZM1.49883 1.49883L0.791726 0.791726C0.436522 1.14693 0.277778 1.59983 0.277778 2.06489H1.27778H2.27778C2.27778 2.05763 2.27867 2.07843 2.26453 2.11464C2.24964 2.15278 2.22708 2.1848 2.20594 2.20594L1.49883 1.49883ZM1.27778 2.06489H0.277778V4.81594H1.27778H2.27778V2.06489H1.27778ZM1.27778 4.81594H0.277778C0.277778 5.28096 0.436583 5.73474 0.793779 6.08988L1.49883 5.38072L2.20389 4.67157C2.22589 4.69344 2.24904 4.72628 2.26425 4.76516C2.27869 4.80203 2.27778 4.82325 2.27778 4.81594H1.27778ZM1.49883 5.38072L0.791726 6.08783C1.14693 6.44303 1.59983 6.60178 2.06489 6.60178V5.60178V4.60178C2.05763 4.60178 2.07843 4.60088 2.11464 4.61502C2.15278 4.62992 2.1848 4.65248 2.20594 4.67362L1.49883 5.38072ZM8.15861 12.6066V13.6066H14.8414V12.6066V11.6066H8.15861V12.6066ZM14.8414 12.6066H15.8414V11.5H14.8414H13.8414V12.6066H14.8414ZM14.8414 11.5V10.5H8.15861V11.5V12.5H14.8414V11.5ZM8.15861 11.5H7.15861V12.6066H8.15861H9.15861V11.5H8.15861Z" fill="#8A8A8A" mask="url(#path-1-inside-1_685_17)"/>
                    </svg>
                    <p>Inventory</p>
                  </NavLink>
                  <NavLink to="/admin" style={link} className="nav-item">
                    <svg width="22" height="25" viewBox="0 0 22 25" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M9.625 0C9.75516 0 9.88625 0.011697 10.0182 0.0350908C10.1502 0.0584846 10.2786 0.0959145 10.4032 0.147381L17.8062 2.95463C18.2316 3.12868 18.5785 3.40801 18.8471 3.7926C19.1157 4.17813 19.25 4.61138 19.25 5.09236V10.5862C19.25 10.7845 19.184 10.9511 19.052 11.0858C18.92 11.2206 18.7564 11.288 18.5611 11.288C18.3659 11.288 18.2027 11.2206 18.0716 11.0858C17.9405 10.9511 17.875 10.7845 17.875 10.5862V5.07411C17.875 4.89351 17.8264 4.73163 17.7292 4.58846C17.633 4.44435 17.4964 4.33627 17.3195 4.26422L9.9165 1.45697C9.8285 1.42047 9.73133 1.40222 9.625 1.40222C9.51866 1.40222 9.4215 1.42047 9.3335 1.45697L1.9305 4.26422C1.75358 4.33627 1.617 4.44388 1.52075 4.58705C1.42358 4.73303 1.375 4.89585 1.375 5.07551V11.1041C1.375 12.4534 1.5675 13.7626 1.9525 15.0314C2.3375 16.3003 2.871 17.4653 3.553 18.5265C4.235 19.5876 5.03342 20.5173 5.94825 21.3155C6.86308 22.1137 7.84896 22.7359 8.90587 23.1823C9.09104 23.2628 9.22716 23.3928 9.31425 23.5725C9.40133 23.7522 9.41279 23.9346 9.34862 24.1199C9.27346 24.3183 9.14237 24.4516 8.95537 24.52C8.76746 24.5883 8.58962 24.5827 8.42187 24.5031C5.84971 23.3914 3.80325 21.5901 2.2825 19.0991C0.760833 16.6091 0 13.9441 0 11.1041V5.09236C0 4.61138 0.134292 4.17813 0.402875 3.7926C0.670542 3.40707 1.0175 3.12775 1.44375 2.95463L8.84812 0.147381C8.97737 0.0884285 9.10662 0.0486594 9.23587 0.0280728C9.36604 0.00935782 9.49575 0 9.625 0ZM16.5 25C14.9682 25 13.6689 24.4554 12.6019 23.3662C11.534 22.2751 11 20.9482 11 19.3855C11 17.8228 11.534 16.4964 12.6019 15.4062C13.6698 14.3161 14.9692 13.771 16.5 13.771C18.0308 13.771 19.3307 14.3161 20.3995 15.4062C21.4683 16.4964 22.0018 17.8228 22 19.3855C21.9982 20.9482 21.4647 22.2751 20.3995 23.3662C19.3343 24.4573 18.0345 25.0019 16.5 25ZM16.5 19.3855C17.0729 19.3855 17.5601 19.181 17.9616 18.7721C18.3631 18.3632 18.5634 17.8658 18.5625 17.2801C18.5616 16.6943 18.3613 16.1974 17.9616 15.7894C17.562 15.3814 17.0747 15.1765 16.5 15.1746C15.9252 15.1727 15.4385 15.3777 15.0397 15.7894C14.641 16.2011 14.4402 16.698 14.4375 17.2801C14.4347 17.8621 14.6355 18.3594 15.0397 18.7721C15.444 19.1848 15.9307 19.3892 16.5 19.3855ZM16.5 23.5964C17.0903 23.5964 17.6555 23.4808 18.1954 23.2497C18.7344 23.0185 19.1987 22.6742 19.5882 22.2166C19.6854 22.095 19.718 21.964 19.6859 21.8236C19.6547 21.6851 19.574 21.5775 19.4439 21.5008C18.9901 21.2547 18.5135 21.0745 18.0139 20.9604C17.5134 20.8462 17.0069 20.7891 16.4945 20.7891C15.9812 20.7891 15.477 20.8462 14.982 20.9604C14.4852 21.0745 14.0103 21.2551 13.5575 21.5022C13.4264 21.577 13.3453 21.6846 13.3141 21.825C13.282 21.9644 13.3141 22.0954 13.4104 22.218C13.8009 22.6747 14.2656 23.0185 14.8046 23.2497C15.3436 23.4808 15.9087 23.5964 16.5 23.5964Z" fill="#8A8A94"/>
                    </svg>
                    <p>Admin</p>
                  </NavLink>
                  <NavLink to="/menu" style={link} className="nav-item">
                    <svg width="23" height="28" viewBox="0 0 23 28" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M16.5802 17.6992C16.5791 17.909 16.4944 18.1098 16.3445 18.2583C16.1945 18.4068 15.9913 18.491 15.7789 18.4925H7.22109C7.00806 18.4925 6.80376 18.4089 6.65313 18.2601C6.5025 18.1114 6.41787 17.9096 6.41787 17.6992C6.41787 17.4888 6.5025 17.2871 6.65313 17.1383C6.80376 16.9895 7.00806 16.906 7.22109 16.906H15.7789C15.9916 16.907 16.1953 16.9909 16.3457 17.1394C16.4961 17.288 16.5811 17.4892 16.5821 17.6992M15.7809 12.681H7.22109C7.0152 12.6911 6.82111 12.779 6.679 12.9265C6.53688 13.074 6.45763 13.2697 6.45763 13.4733C6.45763 13.6769 6.53688 13.8727 6.679 14.0202C6.82111 14.1677 7.0152 14.2556 7.22109 14.2656H15.7789C15.9848 14.2556 16.1789 14.1677 16.321 14.0202C16.4631 13.8727 16.5424 13.6769 16.5424 13.4733C16.5424 13.2697 16.4631 13.074 16.321 12.9265C16.1789 12.779 15.9868 12.6911 15.7809 12.681ZM23 3.96486V26.151C23.0003 26.3937 22.9521 26.6341 22.8582 26.8584C22.7643 27.0828 22.6266 27.2866 22.4529 27.4583C22.2792 27.63 22.073 27.7663 21.8459 27.8592C21.6189 27.9522 21.3755 28 21.1298 28H1.87024C1.37422 28 0.898519 27.8054 0.547781 27.459C0.197043 27.1126 1.03624e-06 26.6428 1.03624e-06 26.1529V3.96291C-0.000257668 3.72019 0.0479265 3.47979 0.141799 3.25547C0.235671 3.03115 0.373391 2.8273 0.547085 2.65558C0.720778 2.48386 0.927039 2.34763 1.15408 2.25469C1.38111 2.16174 1.62447 2.1139 1.87024 2.1139H6.84114C7.4174 1.45083 8.13199 0.918633 8.93595 0.553769C9.73991 0.188904 10.6142 0 11.499 0C12.3838 0 13.2581 0.188904 14.0621 0.553769C14.866 0.918633 15.5806 1.45083 16.1569 2.1139H21.1258C21.3716 2.11365 21.615 2.16124 21.8421 2.25394C22.0693 2.34665 22.2757 2.48267 22.4496 2.65421C22.6234 2.82575 22.7614 3.02945 22.8555 3.25368C22.9496 3.4779 22.998 3.71824 22.998 3.96097M6.95335 6.0744V6.33687H16.0447V6.0744C16.0573 5.47686 15.949 4.88285 15.7261 4.32717C15.5033 3.7715 15.1704 3.26534 14.747 2.83835C14.3235 2.41136 13.8181 2.07214 13.2602 1.84055C12.7023 1.60896 12.1032 1.48967 11.498 1.48967C10.8929 1.48967 10.2938 1.60896 9.7359 1.84055C9.17801 2.07214 8.67253 2.41136 8.24909 2.83835C7.82565 3.26534 7.49276 3.7715 7.26992 4.32717C7.04709 4.88285 6.94076 5.47686 6.95335 6.0744ZM21.3916 3.96097C21.3916 3.92624 21.3847 3.89186 21.3712 3.85978C21.3578 3.8277 21.338 3.79855 21.3132 3.77399C21.2883 3.74944 21.2588 3.72996 21.2263 3.71667C21.1938 3.70338 21.159 3.69654 21.1239 3.69654H17.157C17.4818 4.44704 17.6491 5.25586 17.6491 6.0744V7.13014C17.6481 7.34021 17.5632 7.54139 17.4127 7.68993C17.2623 7.83848 17.0586 7.92238 16.8459 7.9234H6.1521C5.93939 7.92238 5.73569 7.83848 5.58528 7.68993C5.43488 7.54139 5.34992 7.34021 5.34888 7.13014V6.0744C5.34888 5.2578 5.51622 4.44704 5.84105 3.69654H1.87024C1.83508 3.69654 1.80026 3.70338 1.76778 3.71667C1.7353 3.72996 1.70578 3.74944 1.68092 3.77399C1.65606 3.79855 1.63634 3.8277 1.62288 3.85978C1.60943 3.89186 1.6025 3.92624 1.6025 3.96097V26.1471C1.6025 26.2172 1.63071 26.2845 1.68092 26.3341C1.73113 26.3837 1.79923 26.4115 1.87024 26.4115H21.1258C21.1968 26.4115 21.2649 26.3837 21.3151 26.3341C21.3654 26.2845 21.3936 26.2172 21.3936 26.1471L21.3916 3.96097Z" fill="#8A8A94"/>
                    </svg>
                    <p>Menu</p>
                  </NavLink>
                </>
              )}
            </div>
            <div className="header-footer">
              <div className="profile">
                <p>{user?.name || ""}</p>
                <p>{user?.role ? (user.role.charAt(0).toUpperCase() + user.role.slice(1)) : ""}</p>
              </div>
              <span className="logout-btn" onClick={handleSignOut}>
                <svg width="27" height="27" viewBox="0 0 27 27" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M21.1667 17.3333L25 13.5M25 13.5L21.1667 9.66667M25 13.5H7.11111M16.0556 18.6111V21.9333C16.0556 22.3361 15.9762 22.7348 15.8221 23.1069C15.668 23.479 15.4421 23.817 15.1573 24.1018C14.8726 24.3866 14.5345 24.6124 14.1625 24.7666C13.7904 24.9207 13.3916 25 12.9889 25H5.06667C4.25334 25 3.47332 24.6769 2.89821 24.1018C2.32309 23.5267 2 22.7467 2 21.9333V5.06667C2 4.66395 2.07932 4.26517 2.23344 3.8931C2.38755 3.52104 2.61344 3.18297 2.89821 2.89821C3.47332 2.32309 4.25334 2 5.06667 2H12.9889C13.3916 2 13.7904 2.07932 14.1625 2.23344C14.5345 2.38755 14.8726 2.61344 15.1573 2.89821C15.4421 3.18297 15.668 3.52104 15.8221 3.8931C15.9762 4.26517 16.0556 4.66395 16.0556 5.06667V8.38889" stroke="#2563EB" stroke-width="4" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </span>
            </div>
          </nav>
        </aside>
        <main>
          <Outlet />
        </main>
      </div>
      <LowStockToast apiBase="http://localhost:5000" threshold={3} pollMs={30000} />
    </div>
  );
}
